!function(t){t.fn.magnify=function(e){e=t.extend({src:"",speed:100,timeout:-1,touchBottomOffset:0,finalWidth:null,finalHeight:null,magnifiedWidth:null,magnifiedHeight:null,limitBounds:!1,mobileCloseEvent:"touchstart",afterLoad:function(){}},e);var i=this,n=t("html"),a=0,o=function(){clearTimeout(a),a=setTimeout(function(){i.destroy(),i.magnify(e)},100)};return this.destroy=function(){return this.each(function(){var e=t(this),i=e.prev("div.magnify-lens"),n=e.data("originalStyle");e.parent("div.magnify").length&&i.length&&(n?e.attr("style",n):e.removeAttr("style"),e.unwrap(),i.remove())}),t(window).off("resize",o),i},t(window).resize(o),this.each(function(){!function(i){var a=t(i),s=a.closest("a"),r={};for(var f in e)r[f]=a.attr("data-magnify-"+f.toLowerCase());var l=r.src||e.src||s.attr("href")||"";if(l){var d,c,u,h,g,m,p,v,y,b,w=0,N=0,B=function(){var t=d.offset();return b={top:a.offset().top-t.top+parseInt(a.css("border-top-width"))+parseInt(a.css("padding-top")),left:a.offset().left-t.left+parseInt(a.css("border-left-width"))+parseInt(a.css("padding-left"))},t.top+=b.top,t.left+=b.left,t},k=function(){c.is(":visible")&&c.fadeOut(e.speed,function(){n.removeClass("magnifying").trigger("magnifyend")})};isNaN(+r.speed)||(e.speed=+r.speed),isNaN(+r.timeout)||(e.timeout=+r.timeout),isNaN(+r.finalWidth)||(e.finalWidth=+r.finalWidth),isNaN(+r.finalHeight)||(e.finalHeight=+r.finalHeight),isNaN(+r.magnifiedWidth)||(e.magnifiedWidth=+r.magnifiedWidth),isNaN(+r.magnifiedHeight)||(e.magnifiedHeight=+r.magnifiedHeight),"true"===r.limitBounds&&(e.limitBounds=!0),"function"==typeof window[r.afterLoad]&&(e.afterLoad=window[r.afterLoad]),/\b(Android|BlackBerry|IEMobile|iPad|iPhone|Mobile|Opera Mini)\b/.test(navigator.userAgent)?isNaN(+r.touchBottomOffset)||(e.touchBottomOffset=+r.touchBottomOffset):e.touchBottomOffset=0,a.data("originalStyle",a.attr("style"));var E=new Image;t(E).on({load:function(){var i,f;a.css("display","block"),a.parent(".magnify").length||a.wrap('<div class="magnify"></div>'),d=a.parent(".magnify"),a.prev(".magnify-lens").length?d.children(".magnify-lens").css("background-image","url('"+l+"')"):a.before('<div class="magnify-lens loading" style="background:url(\''+l+"') 0 0 no-repeat\"></div>"),(c=d.children(".magnify-lens")).removeClass("loading"),u=e.finalWidth||a.width(),h=e.finalHeight||a.height(),g=e.magnifiedWidth||E.width,m=e.magnifiedHeight||E.height,p=c.width(),v=c.height(),y=B(),e.limitBounds&&(w=p/2/(g/u),N=v/2/(m/h)),g===E.width&&m===E.height||c.css("background-size",g+"px "+m+"px"),a.data("zoomSize",{width:g,height:m}),d.data("mobileCloseEvent",r.mobileCloseEvent||e.mobileCloseEvent),E=null,e.afterLoad(),d.off().on({"mousemove touchmove":function(t){if(t.preventDefault(),h){if(i=(t.pageX||t.originalEvent.touches[0].pageX)-y.left,f=(t.pageY||t.originalEvent.touches[0].pageY)-y.top-e.touchBottomOffset,c.is(":animated")||(i>w&&i<u-w&&f>N&&f<h-N?c.is(":hidden")&&(n.addClass("magnifying").trigger("magnifystart"),c.fadeIn(e.speed)):k()),c.is(":visible")){var a="";if(g&&m){var s=-Math.round(i/u*g-p/2),r=-Math.round(f/h*m-v/2);if(e.limitBounds){var l=-Math.round((u-w)/u*g-p/2),d=-Math.round((h-N)/h*m-v/2);s>0?s=0:s<l&&(s=l),r>0?r=0:r<d&&(r=d)}a=s+"px "+r+"px"}c.css({top:Math.round(f-v/2)+b.top+"px",left:Math.round(i-p/2)+b.left+"px","background-position":a})}}else o()},mouseenter:function(){y=B()},mouseleave:k}),e.timeout>=0&&d.on("touchend",function(){setTimeout(k,e.timeout)}),t("body").not(d).on("touchstart",k);var H=a.attr("usemap");if(H){var W=t("map[name="+H.slice(1)+"]");a.after(W),d.click(function(e){if(e.clientX||e.clientY){c.hide();var n=document.elementFromPoint(e.clientX||e.originalEvent.touches[0].clientX,e.clientY||e.originalEvent.touches[0].clientY);"AREA"===n.nodeName?n.click():t("area",W).each(function(){var e=t(this).attr("coords").split(",");if(i>=e[0]&&i<=e[2]&&f>=e[1]&&f<=e[3])return this.click(),!1})}})}s.length&&(s.css("display","inline-block"),!s.attr("href")||r.src||e.src||s.click(function(t){t.preventDefault()}))},error:function(){E=null}}),E.src=l}}(this)})}}(jQuery);